{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///home/phoenix/Documents/gigs/tickeur/src/lib/utils.ts"],"sourcesContent":["import { clsx, type ClassValue } from 'clsx'\nimport { twMerge } from 'tailwind-merge'\nimport axios from 'axios'\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n\nexport function returnError(error: unknown): string {\n  console.error(error)\n\n  if (axios.isAxiosError(error))\n    return error.response?.data?.message ?? 'An error occurred'\n\n  if (error instanceof Error) return error.message\n\n  return 'An unknown error occurred'\n}\n\n\n\nexport const inDevEnvironment =\n  !!process && process.env.NODE_ENV === 'development'\n\n\nexport function delay(ms: number): Promise<void> {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAIO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,QAAQ,KAAK;AACtB;AAEO,SAAS,YAAY,KAAc;IACxC,QAAQ,KAAK,CAAC;IAEd,IAAI,MAAM,YAAY,CAAC,QACrB,OAAO,MAAM,QAAQ,EAAE,MAAM,WAAW;IAE1C,IAAI,iBAAiB,OAAO,OAAO,MAAM,OAAO;IAEhD,OAAO;AACT;AAIO,MAAM,mBACX,CAAC,CAAC,WAAW,oDAAyB;AAGjC,SAAS,MAAM,EAAU;IAC9B,OAAO,IAAI,QAAQ,CAAC,UAAY,WAAW,SAAS;AACtD","debugId":null}},
    {"offset": {"line": 85, "column": 0}, "map": {"version":3,"sources":["file:///home/phoenix/Documents/gigs/tickeur/src/lib/resend.ts"],"sourcesContent":["import { Resend } from 'resend'\n\nexport const resend = new Resend(process.env.RESEND_API_KEY)\nexport const from_email = process.env.AUTH_EMAIL as string"],"names":[],"mappings":";;;;;;;;;;;;AAEO,MAAM,SAAS,IAAI,OAAO,QAAQ,GAAG,CAAC,cAAc;AACpD,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU","debugId":null}},
    {"offset": {"line": 109, "column": 0}, "map": {"version":3,"sources":["file:///home/phoenix/Documents/gigs/tickeur/src/db/schema/base-table.ts"],"sourcesContent":["import {\n    AnyPgTable,\n    PgColumnBuilderBase,\n    pgTable,\n    uuid,\n    timestamp,\n} from 'drizzle-orm/pg-core';\n\nexport abstract class BaseEntity {\n    id!: string;\n    created_at!: Date;\n    updated_at!: Date;\n    deleted_at!: Date | null;\n}\n\nexport function createBaseTable<\n    T extends Record<string, PgColumnBuilderBase>\n>(\n    tableName: string,\n    columns: T\n) {\n    return pgTable(tableName, {\n        id: uuid('id').defaultRandom().primaryKey(),\n        created_at: timestamp('created_at').defaultNow().notNull(),\n        updated_at: timestamp('updated_at').defaultNow().notNull(),\n        deleted_at: timestamp('deleted_at'),\n        ...columns,\n    });\n}\n\nexport const baseTable = createBaseTable('base', {});\n\nexport type BaseTableRow = typeof baseTable.$inferSelect;\nexport type BaseTableInsert = typeof baseTable.$inferInsert;\n\nexport type BaseColumns = {\n    id: typeof baseTable.id;\n    created_at: typeof baseTable.created_at;\n    updated_at: typeof baseTable.updated_at;\n    deleted_at: typeof baseTable.deleted_at;\n};\n\nexport type WithBaseColumns<T extends AnyPgTable> = T & BaseColumns;"],"names":[],"mappings":";;;;;;;;;;;;;;AAQO,MAAe;IAClB,GAAY;IACZ,WAAkB;IAClB,WAAkB;IAClB,WAAyB;AAC7B;AAEO,SAAS,gBAGZ,SAAiB,EACjB,OAAU;IAEV,OAAO,QAAQ,WAAW;QACtB,IAAI,KAAK,MAAM,aAAa,GAAG,UAAU;QACzC,YAAY,UAAU,cAAc,UAAU,GAAG,OAAO;QACxD,YAAY,UAAU,cAAc,UAAU,GAAG,OAAO;QACxD,YAAY,UAAU;QACtB,GAAG,OAAO;IACd;AACJ;AAEO,MAAM,YAAY,gBAAgB,QAAQ,CAAC","debugId":null}},
    {"offset": {"line": 143, "column": 0}, "map": {"version":3,"sources":["file:///home/phoenix/Documents/gigs/tickeur/src/db/schema/user.ts"],"sourcesContent":["import {\n    uuid,\n    varchar,\n    text,\n    timestamp,\n    boolean,\n    integer,\n    jsonb\n} from 'drizzle-orm/pg-core'\nimport { BaseEntity, createBaseTable } from './base-table';\n\n\nexport const userTypes = ['admin', 'normal'] as const;\nexport type UserType = typeof userTypes[number];\n\nexport const users = createBaseTable('users', {\n    email: varchar('email', { length: 255 }).notNull().unique(),\n    username: varchar('username', { length: 50 }).unique(),\n    first_name: varchar('first_name', { length: 100 }),\n    last_name: varchar('last_name', { length: 100 }),\n\n\n    user_type: varchar('user_type', { length: 20 }).notNull().default('normal'),\n\n    password: varchar('password', { length: 255 }),\n\n    avatar: text('avatar'),\n\n    registration_documents: jsonb('registration_documents').$type<string[]>(),\n    valid_id: varchar('valid_id', { length: 500 }),\n\n    is_active: boolean('is_active').default(true),\n    is_verified: boolean('is_verified').default(false),\n    is_onboarded: boolean('is_onboarded').default(false),\n    onboarding_status: varchar('onboarding_status', { length: 20 }).default('pending'), // pending, approved, declined\n\n\n    google_id: varchar('google_id', { length: 255 }),\n\n    last_login_at: timestamp('last_login_at'),\n    email_verified_at: timestamp('email_verified_at'),\n});\n\nexport const verification_otps = createBaseTable('verification_otps', {\n    user_id: uuid('user_id').references(() => users.id, { onDelete: 'cascade' }).notNull(),\n    otp: varchar('otp', { length: 6 }).notNull(),\n    type: varchar('type', { length: 50 }).notNull(),\n    expires_at: timestamp('expires_at').notNull(),\n    attempts: integer('attempts').default(0),\n});\n\n\nexport type User = typeof users.$inferSelect & BaseEntity;\nexport type NewUser = typeof users.$inferInsert;\n\nexport type VerificationOTP = typeof verification_otps.$inferSelect & BaseEntity;\nexport type NewVerificationOTP = typeof verification_otps.$inferInsert;\n"],"names":[],"mappings":";;;;;;;;;;;;;AASA;;;AAGO,MAAM,YAAY;IAAC;IAAS;CAAS;AAGrC,MAAM,QAAQ,IAAA,uJAAe,EAAC,SAAS;IAC1C,OAAO,QAAQ,SAAS;QAAE,QAAQ;IAAI,GAAG,OAAO,GAAG,MAAM;IACzD,UAAU,QAAQ,YAAY;QAAE,QAAQ;IAAG,GAAG,MAAM;IACpD,YAAY,QAAQ,cAAc;QAAE,QAAQ;IAAI;IAChD,WAAW,QAAQ,aAAa;QAAE,QAAQ;IAAI;IAG9C,WAAW,QAAQ,aAAa;QAAE,QAAQ;IAAG,GAAG,OAAO,GAAG,OAAO,CAAC;IAElE,UAAU,QAAQ,YAAY;QAAE,QAAQ;IAAI;IAE5C,QAAQ,KAAK;IAEb,wBAAwB,MAAM,0BAA0B,KAAK;IAC7D,UAAU,QAAQ,YAAY;QAAE,QAAQ;IAAI;IAE5C,WAAW,QAAQ,aAAa,OAAO,CAAC;IACxC,aAAa,QAAQ,eAAe,OAAO,CAAC;IAC5C,cAAc,QAAQ,gBAAgB,OAAO,CAAC;IAC9C,mBAAmB,QAAQ,qBAAqB;QAAE,QAAQ;IAAG,GAAG,OAAO,CAAC;IAGxE,WAAW,QAAQ,aAAa;QAAE,QAAQ;IAAI;IAE9C,eAAe,UAAU;IACzB,mBAAmB,UAAU;AACjC;AAEO,MAAM,oBAAoB,IAAA,uJAAe,EAAC,qBAAqB;IAClE,SAAS,KAAK,WAAW,UAAU,CAAC,IAAM,MAAM,EAAE,EAAE;QAAE,UAAU;IAAU,GAAG,OAAO;IACpF,KAAK,QAAQ,OAAO;QAAE,QAAQ;IAAE,GAAG,OAAO;IAC1C,MAAM,QAAQ,QAAQ;QAAE,QAAQ;IAAG,GAAG,OAAO;IAC7C,YAAY,UAAU,cAAc,OAAO;IAC3C,UAAU,QAAQ,YAAY,OAAO,CAAC;AAC1C","debugId":null}},
    {"offset": {"line": 216, "column": 0}, "map": {"version":3,"sources":["file:///home/phoenix/Documents/gigs/tickeur/src/db/schema/index.ts"],"sourcesContent":["export * from \"./user\""],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 237, "column": 0}, "map": {"version":3,"sources":["file:///home/phoenix/Documents/gigs/tickeur/src/db/drizzle.ts"],"sourcesContent":["import * as schema from \"./schema\"\nimport { drizzle } from \"drizzle-orm/neon-http\"\nimport { neon } from \"@neondatabase/serverless\"\n\nif (!process.env.DATABASE_URL) {\n    throw new Error(\"DATABASE_URL is not set\")\n}\n\nconst sql = neon(process.env.DATABASE_URL)\nexport const db = drizzle(sql, { schema })"],"names":[],"mappings":";;;;AAAA;AAAA;;;;;;;;;;;;;;AAIA,IAAI,CAAC,QAAQ,GAAG,CAAC,YAAY,EAAE;IAC3B,MAAM,IAAI,MAAM;AACpB;AAEA,MAAM,MAAM,KAAK,QAAQ,GAAG,CAAC,YAAY;AAClC,MAAM,KAAK,QAAQ,KAAK;IAAE,QAAA;AAAO","debugId":null}},
    {"offset": {"line": 267, "column": 0}, "map": {"version":3,"sources":["file:///home/phoenix/Documents/gigs/tickeur/src/services/base-service.ts"],"sourcesContent":["// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-nocheck\nimport { db } from '~/db/drizzle';\nimport { AnyPgTable, PgUpdateSetSource } from 'drizzle-orm/pg-core';\nimport { eq, isNull, and, isNotNull, sql } from 'drizzle-orm';\nimport { WithBaseColumns } from '../db/schema/base-table';\n\nexport abstract class BaseService<TTable extends WithBaseColumns<AnyPgTable>> {\n    protected abstract table: TTable;\n\n    private get cols() {\n        return this.table;\n    }\n\n    async softDelete(id: string): Promise<void> {\n        const updateData: PgUpdateSetSource<TTable> = {\n            deleted_at: sql`${new Date()}`,\n            updated_at: sql`${new Date()}`,\n        };\n\n        await db.update(this.table)\n            .set(updateData)\n            .where(eq(this.cols.id, id));\n    }\n\n    async restore(id: string): Promise<void> {\n        const updateData: PgUpdateSetSource<TTable> = {\n            deleted_at: sql`${null}`,\n            updated_at: sql`${new Date()}`,\n        };\n\n        await db.update(this.table)\n            .set(updateData)\n            .where(eq(this.cols.id, id));\n    }\n\n    async hardDelete(id: string): Promise<void> {\n        await db.delete(this.table)\n            .where(eq(this.cols.id, id));\n    }\n\n    async getAll(): Promise<TTable['$inferSelect'][]> {\n        return await db.select()\n            .from(this.table)\n            .where(isNull(this.cols.deleted_at));\n    }\n\n    async getById(id: string): Promise<TTable['$inferSelect'] | null> {\n        const [record] = await db.select()\n            .from(this.table)\n            .where(and(eq(this.cols.id, id), isNull(this.cols.deleted_at)))\n            .limit(1);\n\n        return record ?? null;\n    }\n\n    async getAllWithDeleted(): Promise<TTable['$inferSelect'][]> {\n        return await db.select().from(this.table);\n    }\n\n    async getDeleted(): Promise<TTable['$inferSelect'][]> {\n        return await db.select()\n            .from(this.table)\n            .where(isNotNull(this.cols.deleted_at));\n    }\n\n    protected getUpdateTimestamp(): PgUpdateSetSource<TTable> {\n        return {\n            updated_at: sql`${new Date()}`,\n        };\n    }\n}\n"],"names":[],"mappings":"AAAA,6DAA6D;AAC7D,cAAc;;;;;AACd;;;;;;;;AAKO,MAAe;IAGlB,IAAY,OAAO;QACf,OAAO,IAAI,CAAC,KAAK;IACrB;IAEA,MAAM,WAAW,EAAU,EAAiB;QACxC,MAAM,aAAwC;YAC1C,YAAY,GAAG,CAAC,EAAE,IAAI,OAAO,CAAC;YAC9B,YAAY,GAAG,CAAC,EAAE,IAAI,OAAO,CAAC;QAClC;QAEA,MAAM,0HAAE,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,EACrB,GAAG,CAAC,YACJ,KAAK,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE;IAChC;IAEA,MAAM,QAAQ,EAAU,EAAiB;QACrC,MAAM,aAAwC;YAC1C,YAAY,GAAG,CAAC,EAAE,KAAK,CAAC;YACxB,YAAY,GAAG,CAAC,EAAE,IAAI,OAAO,CAAC;QAClC;QAEA,MAAM,0HAAE,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,EACrB,GAAG,CAAC,YACJ,KAAK,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE;IAChC;IAEA,MAAM,WAAW,EAAU,EAAiB;QACxC,MAAM,0HAAE,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,EACrB,KAAK,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE;IAChC;IAEA,MAAM,SAA4C;QAC9C,OAAO,MAAM,0HAAE,CAAC,MAAM,GACjB,IAAI,CAAC,IAAI,CAAC,KAAK,EACf,KAAK,CAAC,OAAO,IAAI,CAAC,IAAI,CAAC,UAAU;IAC1C;IAEA,MAAM,QAAQ,EAAU,EAA0C;QAC9D,MAAM,CAAC,OAAO,GAAG,MAAM,0HAAE,CAAC,MAAM,GAC3B,IAAI,CAAC,IAAI,CAAC,KAAK,EACf,KAAK,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,KAAK,OAAO,IAAI,CAAC,IAAI,CAAC,UAAU,IAC3D,KAAK,CAAC;QAEX,OAAO,UAAU;IACrB;IAEA,MAAM,oBAAuD;QACzD,OAAO,MAAM,0HAAE,CAAC,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK;IAC5C;IAEA,MAAM,aAAgD;QAClD,OAAO,MAAM,0HAAE,CAAC,MAAM,GACjB,IAAI,CAAC,IAAI,CAAC,KAAK,EACf,KAAK,CAAC,UAAU,IAAI,CAAC,IAAI,CAAC,UAAU;IAC7C;IAEU,qBAAgD;QACtD,OAAO;YACH,YAAY,GAAG,CAAC,EAAE,IAAI,OAAO,CAAC;QAClC;IACJ;AACJ","debugId":null}},
    {"offset": {"line": 325, "column": 0}, "map": {"version":3,"sources":["file:///home/phoenix/Documents/gigs/tickeur/src/services/user-service.ts"],"sourcesContent":["import { eq } from 'drizzle-orm';\nimport { db } from '~/db/drizzle';\nimport { BaseService } from './base-service';\nimport { NewUser, User, users } from '~/db/schema/user';\nimport { genSaltSync, hashSync, compareSync } from \"bcrypt-ts\";\n\nexport class UserService extends BaseService<typeof users> {\n    protected table = users;\n    constructor() {\n        super();\n    }\n\n    async hashPassword(password: string): Promise<string> {\n        const salt = genSaltSync(10);\n        return hashSync(password, salt);\n    }\n\n    async comparePassword(password: string, hash: string): Promise<boolean> {\n        return compareSync(password, hash);\n    }\n\n    async createUser(data: NewUser): Promise<User> {\n        const insertData = { ...data };\n\n        if (insertData.password) {\n            insertData.password = await this.hashPassword(insertData.password);\n        }\n\n        const [user] = await db.insert(users).values(insertData).returning();\n        return user;\n    }\n\n    async findByEmail(email: string): Promise<User | undefined> {\n        const [user] = await db\n            .select()\n            .from(users)\n            .where(eq(users.email, email));\n\n        return user;\n    }\n\n    async findById(id: string): Promise<User | undefined> {\n        const [user] = await db\n            .select()\n            .from(users)\n            .where(eq(users.id, id));\n\n        return user;\n    }\n\n    async findOrCreateSocialUser(\n        providerId: string,\n        data: Omit<NewUser, 'id'>\n    ): Promise<User> {\n        const [existing] = await db\n            .select()\n            .from(users)\n            .where(eq(users.google_id, providerId));\n\n        if (existing) return existing;\n\n        const [userbyemail] = await db.select().from(users).where(eq(users.email, data.email));\n        if (userbyemail) {\n            await db\n                .update(users)\n                .set({\n                    google_id: providerId,\n                    is_active: true,\n                    is_verified: true,\n                })\n                .where(eq(users.id, userbyemail.id));\n            return userbyemail;\n        }\n\n        const [newUser] = await db\n            .insert(users)\n            .values({\n                ...data,\n                google_id: providerId,\n                is_active: true,\n                is_verified: true,\n                email_verified_at: new Date(),\n            })\n            .returning();\n\n        return newUser;\n    }\n\n    /**\n   * Update any user field(s) by id\n   */\n    async updateUser(id: string, updates: Partial<User>): Promise<User | undefined> {\n        const updateData = { ...updates };\n        if (updateData.password) {\n            updateData.password = await this.hashPassword(updateData.password);\n        }\n\n        const [user] = await db\n            .update(users)\n            .set(updateData)\n            .where(eq(users.id, id))\n            .returning();\n\n        return user;\n    }\n\n}\n"],"names":[],"mappings":";;;;;;;;;AACA;AACA;AACA;;;;;;;;;;;AAGO,MAAM,oBAAoB,iJAAW;IAC9B,QAAQ,oIAAK,CAAC;IACxB,aAAc;QACV,KAAK;IACT;IAEA,MAAM,aAAa,QAAgB,EAAmB;QAClD,MAAM,OAAO,YAAY;QACzB,OAAO,SAAS,UAAU;IAC9B;IAEA,MAAM,gBAAgB,QAAgB,EAAE,IAAY,EAAoB;QACpE,OAAO,YAAY,UAAU;IACjC;IAEA,MAAM,WAAW,IAAa,EAAiB;QAC3C,MAAM,aAAa;YAAE,GAAG,IAAI;QAAC;QAE7B,IAAI,WAAW,QAAQ,EAAE;YACrB,WAAW,QAAQ,GAAG,MAAM,IAAI,CAAC,YAAY,CAAC,WAAW,QAAQ;QACrE;QAEA,MAAM,CAAC,KAAK,GAAG,MAAM,0HAAE,CAAC,MAAM,CAAC,oIAAK,EAAE,MAAM,CAAC,YAAY,SAAS;QAClE,OAAO;IACX;IAEA,MAAM,YAAY,KAAa,EAA6B;QACxD,MAAM,CAAC,KAAK,GAAG,MAAM,0HAAE,CAClB,MAAM,GACN,IAAI,CAAC,oIAAK,EACV,KAAK,CAAC,GAAG,oIAAK,CAAC,KAAK,EAAE;QAE3B,OAAO;IACX;IAEA,MAAM,SAAS,EAAU,EAA6B;QAClD,MAAM,CAAC,KAAK,GAAG,MAAM,0HAAE,CAClB,MAAM,GACN,IAAI,CAAC,oIAAK,EACV,KAAK,CAAC,GAAG,oIAAK,CAAC,EAAE,EAAE;QAExB,OAAO;IACX;IAEA,MAAM,uBACF,UAAkB,EAClB,IAAyB,EACZ;QACb,MAAM,CAAC,SAAS,GAAG,MAAM,0HAAE,CACtB,MAAM,GACN,IAAI,CAAC,oIAAK,EACV,KAAK,CAAC,GAAG,oIAAK,CAAC,SAAS,EAAE;QAE/B,IAAI,UAAU,OAAO;QAErB,MAAM,CAAC,YAAY,GAAG,MAAM,0HAAE,CAAC,MAAM,GAAG,IAAI,CAAC,oIAAK,EAAE,KAAK,CAAC,GAAG,oIAAK,CAAC,KAAK,EAAE,KAAK,KAAK;QACpF,IAAI,aAAa;YACb,MAAM,0HAAE,CACH,MAAM,CAAC,oIAAK,EACZ,GAAG,CAAC;gBACD,WAAW;gBACX,WAAW;gBACX,aAAa;YACjB,GACC,KAAK,CAAC,GAAG,oIAAK,CAAC,EAAE,EAAE,YAAY,EAAE;YACtC,OAAO;QACX;QAEA,MAAM,CAAC,QAAQ,GAAG,MAAM,0HAAE,CACrB,MAAM,CAAC,oIAAK,EACZ,MAAM,CAAC;YACJ,GAAG,IAAI;YACP,WAAW;YACX,WAAW;YACX,aAAa;YACb,mBAAmB,IAAI;QAC3B,GACC,SAAS;QAEd,OAAO;IACX;IAEA;;GAED,GACC,MAAM,WAAW,EAAU,EAAE,OAAsB,EAA6B;QAC5E,MAAM,aAAa;YAAE,GAAG,OAAO;QAAC;QAChC,IAAI,WAAW,QAAQ,EAAE;YACrB,WAAW,QAAQ,GAAG,MAAM,IAAI,CAAC,YAAY,CAAC,WAAW,QAAQ;QACrE;QAEA,MAAM,CAAC,KAAK,GAAG,MAAM,0HAAE,CAClB,MAAM,CAAC,oIAAK,EACZ,GAAG,CAAC,YACJ,KAAK,CAAC,GAAG,oIAAK,CAAC,EAAE,EAAE,KACnB,SAAS;QAEd,OAAO;IACX;AAEJ","debugId":null}},
    {"offset": {"line": 415, "column": 0}, "map": {"version":3,"sources":["file:///home/phoenix/Documents/gigs/tickeur/src/services/otp-service.ts"],"sourcesContent":["import { db } from '~/db/drizzle';\nimport { eq, and, gte } from 'drizzle-orm';\nimport { BaseService } from './base-service';\nimport { NewVerificationOTP, VerificationOTP, verification_otps } from '~/db/schema/user';\n\nexport type OTPType = 'email_verification' | 'password_reset' | 'login_verification' | 'account_activation';\n\nexport class OTPService extends BaseService<typeof verification_otps> {\n    protected table = verification_otps;\n\n    constructor() {\n        super();\n    }\n\n    /**\n     * Generate a random 6-digit OTP\n     */\n    private generateOTP(): string {\n        return Math.floor(100000 + Math.random() * 900000).toString();\n    }\n\n    /**\n     * Create a new OTP for a user\n     */\n    async createOTP(\n        userId: string,\n        type: OTPType,\n        expiryMinutes: number = 10\n    ): Promise<VerificationOTP> {\n        await this.deleteExistingOTP(userId, type);\n        const otp = this.generateOTP();\n        const expiresAt = new Date();\n        expiresAt.setMinutes(expiresAt.getMinutes() + expiryMinutes);\n\n        const insertData: NewVerificationOTP = {\n            user_id: userId,\n            otp,\n            type,\n            expires_at: expiresAt,\n            attempts: 0\n        };\n\n        const [newOTP] = await db\n            .insert(verification_otps)\n            .values(insertData)\n            .returning();\n\n        return newOTP;\n    }\n\n    /**\n     * Verify an OTP\n     */\n    async verifyOTP(\n        userId: string,\n        otp: string,\n        type: OTPType\n    ): Promise<{ success: boolean; message: string; otpRecord?: VerificationOTP }> {\n        const [otpRecord] = await db\n            .select()\n            .from(verification_otps)\n            .where(\n                and(\n                    eq(verification_otps.user_id, userId),\n                    eq(verification_otps.type, type),\n                    gte(verification_otps.expires_at, new Date())\n                )\n            );\n\n        if (!otpRecord) {\n            return {\n                success: false,\n                message: \"OTP not found or has expired\"\n            };\n        }\n\n        await db\n            .update(verification_otps)\n            .set({\n                attempts: (otpRecord.attempts ?? 0) + 1,\n                updated_at: new Date()\n            })\n            .where(eq(verification_otps.id, otpRecord.id));\n\n        if ((otpRecord.attempts ?? 0) >= 5) {\n            await this.deleteOTP(otpRecord.id);\n            return {\n                success: false,\n                message: \"Too many failed attempts. Please request a new OTP.\"\n            };\n        }\n        if (otpRecord.otp !== otp) {\n            return {\n                success: false,\n                message: \"Invalid OTP\"\n            };\n        }\n        await this.deleteOTP(otpRecord.id);\n\n        return {\n            success: true,\n            message: \"OTP verified successfully\",\n            otpRecord\n        };\n    }\n\n    /**\n     * Find valid OTP by user ID and type\n     */\n    async findValidOTP(userId: string, type: OTPType): Promise<VerificationOTP | undefined> {\n        const [otpRecord] = await db\n            .select()\n            .from(verification_otps)\n            .where(\n                and(\n                    eq(verification_otps.user_id, userId),\n                    eq(verification_otps.type, type),\n                    gte(verification_otps.expires_at, new Date())\n                )\n            );\n\n        return otpRecord;\n    }\n\n    /**\n     * Delete an OTP by ID\n     */\n    async deleteOTP(otpId: string): Promise<boolean> {\n        const result = await db\n            .delete(verification_otps)\n            .where(eq(verification_otps.id, otpId));\n\n        return result.rowCount > 0;\n    }\n\n    /**\n     * Delete existing OTP for user and type\n     */\n    async deleteExistingOTP(userId: string, type: OTPType): Promise<void> {\n        await db\n            .delete(verification_otps)\n            .where(\n                and(\n                    eq(verification_otps.user_id, userId),\n                    eq(verification_otps.type, type)\n                )\n            );\n    }\n\n    /**\n     * Delete expired OTPs (cleanup function)\n     */\n    async deleteExpiredOTPs(): Promise<number> {\n        const result = await db\n            .delete(verification_otps)\n            .where(\n                gte(verification_otps.expires_at, new Date())\n            );\n\n        return result.rowCount;\n    }\n\n    /**\n     * Get OTP attempts count\n     */\n    async getOTPAttempts(userId: string, type: OTPType): Promise<number> {\n        const otpRecord = await this.findValidOTP(userId, type);\n        return otpRecord?.attempts || 0;\n    }\n\n    /**\n     * Check if user can request new OTP (rate limiting)\n     */\n    async canRequestNewOTP(\n        userId: string,\n        type: OTPType,\n        cooldownMinutes: number = 1\n    ): Promise<{ canRequest: boolean; timeLeft?: number }> {\n        const [recentOTP] = await db\n            .select()\n            .from(verification_otps)\n            .where(\n                and(\n                    eq(verification_otps.user_id, userId),\n                    eq(verification_otps.type, type)\n                )\n            )\n            .orderBy(verification_otps.created_at)\n            .limit(1);\n\n        if (!recentOTP) {\n            return { canRequest: true };\n        }\n\n        const cooldownMs = cooldownMinutes * 60 * 1000;\n        const timeSinceCreation = Date.now() - recentOTP.created_at.getTime();\n\n        if (timeSinceCreation < cooldownMs) {\n            const timeLeft = Math.ceil((cooldownMs - timeSinceCreation) / 1000);\n            return {\n                canRequest: false,\n                timeLeft\n            };\n        }\n\n        return { canRequest: true };\n    }\n\n    /**\n     * Batch delete OTPs for a user (useful when user is deleted)\n     */\n    async deleteUserOTPs(userId: string): Promise<number> {\n        const result = await db\n            .delete(verification_otps)\n            .where(eq(verification_otps.user_id, userId));\n\n        return result.rowCount;\n    }\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 554, "column": 0}, "map": {"version":3,"sources":["file:///home/phoenix/Documents/gigs/tickeur/src/lib/emails/verifications/verification-email.tsx"],"sourcesContent":["import {\n  Html,\n  Head,\n  Preview,\n  Body,\n  Container,\n  Section,\n  Heading,\n  Text,\n  Hr,\n} from '@react-email/components'\n\ninterface VerificationEmailProps {\n  firstName?: string\n  otp: string\n}\n\nexport const VerificationEmail = ({\n  firstName,\n  otp,\n}: VerificationEmailProps) => {\n  return (\n    <Html>\n      <Head />\n      <Preview>Your verification code is {otp}</Preview>\n      <Body style={main}>\n        <Container style={container}>\n          <Section style={box}>\n            <Heading style={h1}>Verify your email address</Heading>\n            <Text style={text}>Hi {firstName || 'there'},</Text>\n            <Text style={text}>\n              Thank you for signing up! Please use the following verification\n              code to verify your email address:\n            </Text>\n            <Section style={otpContainer}>\n              <Text style={otpText}>{otp}</Text>\n            </Section>\n            <Text style={text}>\n              This code will expire in 10 minutes. If you didn&apos;t create an\n              account, you can safely ignore this email.\n            </Text>\n            <Hr style={hr} />\n            <Text style={footer}>\n              For security reasons, never share this code with anyone.\n            </Text>\n          </Section>\n        </Container>\n      </Body>\n    </Html>\n  )\n}\n\nconst main = {\n  backgroundColor: '#f6f9fc',\n  fontFamily:\n    '-apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,\"Helvetica Neue\",Ubuntu,sans-serif',\n}\n\nconst container = {\n  backgroundColor: '#ffffff',\n  margin: '0 auto',\n  padding: '20px 0 48px',\n  marginBottom: '64px',\n}\n\nconst box = {\n  padding: '0 48px',\n}\n\nconst h1 = {\n  color: '#333',\n  fontSize: '24px',\n  fontWeight: '600',\n  lineHeight: '40px',\n  margin: '0 0 20px',\n}\n\nconst text = {\n  color: '#333',\n  fontSize: '16px',\n  lineHeight: '26px',\n}\n\nconst otpContainer = {\n  backgroundColor: '#f8f9fa',\n  border: '2px dashed #007ee6',\n  borderRadius: '8px',\n  padding: '20px',\n  textAlign: 'center' as const,\n  margin: '20px 0',\n}\n\nconst otpText = {\n  fontSize: '32px',\n  fontWeight: '700',\n  color: '#007ee6',\n  letterSpacing: '8px',\n  margin: '0',\n  fontFamily: 'Courier, monospace',\n}\n\nconst hr = {\n  borderColor: '#e6ebf1',\n  margin: '20px 0',\n}\n\nconst footer = {\n  color: '#8898aa',\n  fontSize: '12px',\n  lineHeight: '16px',\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAiBO,MAAM,oBAAoB,CAAC,EAChC,SAAS,EACT,GAAG,EACoB;IACvB,qBACE,6WAAC;;0BACC,6WAAC;;;;;0BACD,6WAAC;;oBAAQ;oBAA2B;;;;;;;0BACpC,6WAAC;gBAAK,OAAO;0BACX,cAAA,6WAAC;oBAAU,OAAO;8BAChB,cAAA,6WAAC;wBAAQ,OAAO;;0CACd,6WAAC;gCAAQ,OAAO;0CAAI;;;;;;0CACpB,6WAAC;gCAAK,OAAO;;oCAAM;oCAAI,aAAa;oCAAQ;;;;;;;0CAC5C,6WAAC;gCAAK,OAAO;0CAAM;;;;;;0CAInB,6WAAC;gCAAQ,OAAO;0CACd,cAAA,6WAAC;oCAAK,OAAO;8CAAU;;;;;;;;;;;0CAEzB,6WAAC;gCAAK,OAAO;0CAAM;;;;;;0CAInB,6WAAC;gCAAG,OAAO;;;;;;0CACX,6WAAC;gCAAK,OAAO;0CAAQ;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQjC;AAEA,MAAM,OAAO;IACX,iBAAiB;IACjB,YACE;AACJ;AAEA,MAAM,YAAY;IAChB,iBAAiB;IACjB,QAAQ;IACR,SAAS;IACT,cAAc;AAChB;AAEA,MAAM,MAAM;IACV,SAAS;AACX;AAEA,MAAM,KAAK;IACT,OAAO;IACP,UAAU;IACV,YAAY;IACZ,YAAY;IACZ,QAAQ;AACV;AAEA,MAAM,OAAO;IACX,OAAO;IACP,UAAU;IACV,YAAY;AACd;AAEA,MAAM,eAAe;IACnB,iBAAiB;IACjB,QAAQ;IACR,cAAc;IACd,SAAS;IACT,WAAW;IACX,QAAQ;AACV;AAEA,MAAM,UAAU;IACd,UAAU;IACV,YAAY;IACZ,OAAO;IACP,eAAe;IACf,QAAQ;IACR,YAAY;AACd;AAEA,MAAM,KAAK;IACT,aAAa;IACb,QAAQ;AACV;AAEA,MAAM,SAAS;IACb,OAAO;IACP,UAAU;IACV,YAAY;AACd","debugId":null}},
    {"offset": {"line": 734, "column": 0}, "map": {"version":3,"sources":["file:///home/phoenix/Documents/gigs/tickeur/src/lib/emails/onboarding/onboarding-response-email.tsx"],"sourcesContent":["import {\n  Html,\n  Head,\n  Preview,\n  Body,\n  Container,\n  Section,\n  Heading,\n  Text,\n  Hr,\n  Link,\n  Button,\n} from '@react-email/components'\n\ninterface OnboardingResponseEmailProps {\n  userName: string\n  userEmail: string\n  userId: string\n  documents: string[]\n  verificationUrl: string\n}\n\nexport const OnboardingResponseEmail = ({\n  userName,\n  userEmail,\n  userId,\n  documents,\n  verificationUrl,\n}: OnboardingResponseEmailProps) => {\n  return (\n    <Html>\n      <Head />\n      <Preview>New onboarding response from {userName}</Preview>\n      <Body style={main}>\n        <Container style={container}>\n          <Section style={box}>\n            <Heading style={h1}>New Onboarding Response</Heading>\n            <Text style={text}>\n              A new user has completed their onboarding process.\n            </Text>\n\n            <Hr style={hr} />\n\n            <Section style={infoSection}>\n              <Heading style={h2}>User Information</Heading>\n              <Text style={infoText}>\n                <strong>Name:</strong> {userName}\n              </Text>\n              <Text style={infoText}>\n                <strong>Email:</strong> {userEmail}\n              </Text>\n              <Text style={infoText}>\n                <strong>User ID:</strong> {userId}\n              </Text>\n            </Section>\n\n            <Hr style={hr} />\n\n            <Section style={documentsSection}>\n              <Heading style={h2}>Submitted Documents</Heading>\n              {documents.length > 0 ? (\n                <Section>\n                  {documents.map((doc, index) => (\n                    <Section key={index} style={documentItem}>\n                      <Text style={documentText}>\n                        {index + 1}. <Link href={doc} style={link}>{doc}</Link>\n                      </Text>\n                    </Section>\n                  ))}\n                </Section>\n              ) : (\n                <Text style={text}>No documents submitted.</Text>\n              )}\n            </Section>\n\n            <Hr style={hr} />\n\n            <Section style={actionSection}>\n              <Button href={verificationUrl} style={buttonStyle}>\n                Review and Verify User\n              </Button>\n            </Section>\n\n            <Hr style={hr} />\n\n            <Text style={footer}>\n              This is an automated notification from your Ticketuer application.\n            </Text>\n          </Section>\n        </Container>\n      </Body>\n    </Html>\n  )\n}\n\nconst main = {\n  backgroundColor: '#f6f9fc',\n  fontFamily:\n    '-apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,\"Helvetica Neue\",Ubuntu,sans-serif',\n}\n\nconst container = {\n  backgroundColor: '#ffffff',\n  margin: '0 auto',\n  padding: '20px 0 48px',\n  marginBottom: '64px',\n}\n\nconst box = {\n  padding: '0 48px',\n}\n\nconst h1 = {\n  color: '#333',\n  fontSize: '24px',\n  fontWeight: '600',\n  lineHeight: '40px',\n  margin: '0 0 20px',\n}\n\nconst h2 = {\n  color: '#333',\n  fontSize: '20px',\n  fontWeight: '600',\n  lineHeight: '32px',\n  margin: '16px 0 12px',\n}\n\nconst text = {\n  color: '#333',\n  fontSize: '16px',\n  lineHeight: '26px',\n}\n\nconst infoSection = {\n  marginBottom: '16px',\n}\n\nconst infoText = {\n  color: '#333',\n  fontSize: '16px',\n  lineHeight: '26px',\n  margin: '8px 0',\n}\n\nconst documentsSection = {\n  marginTop: '16px',\n}\n\nconst documentItem = {\n  marginBottom: '8px',\n}\n\nconst documentText = {\n  color: '#333',\n  fontSize: '14px',\n  lineHeight: '24px',\n  margin: '4px 0',\n}\n\nconst link = {\n  color: '#007ee6',\n  textDecoration: 'underline',\n}\n\nconst hr = {\n  borderColor: '#e6ebf1',\n  margin: '20px 0',\n}\n\nconst actionSection = {\n  textAlign: 'center' as const,\n  marginTop: '20px',\n  marginBottom: '20px',\n}\n\nconst buttonStyle = {\n  backgroundColor: '#007ee6',\n  borderRadius: '8px',\n  color: '#ffffff',\n  fontSize: '16px',\n  fontWeight: '600',\n  textDecoration: 'none',\n  textAlign: 'center' as const,\n  display: 'inline-block',\n  padding: '12px 32px',\n}\n\nconst footer = {\n  color: '#8898aa',\n  fontSize: '12px',\n  lineHeight: '16px',\n  marginTop: '20px',\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAsBO,MAAM,0BAA0B,CAAC,EACtC,QAAQ,EACR,SAAS,EACT,MAAM,EACN,SAAS,EACT,eAAe,EACc;IAC7B,qBACE,6WAAC;;0BACC,6WAAC;;;;;0BACD,6WAAC;;oBAAQ;oBAA8B;;;;;;;0BACvC,6WAAC;gBAAK,OAAO;0BACX,cAAA,6WAAC;oBAAU,OAAO;8BAChB,cAAA,6WAAC;wBAAQ,OAAO;;0CACd,6WAAC;gCAAQ,OAAO;0CAAI;;;;;;0CACpB,6WAAC;gCAAK,OAAO;0CAAM;;;;;;0CAInB,6WAAC;gCAAG,OAAO;;;;;;0CAEX,6WAAC;gCAAQ,OAAO;;kDACd,6WAAC;wCAAQ,OAAO;kDAAI;;;;;;kDACpB,6WAAC;wCAAK,OAAO;;0DACX,6WAAC;0DAAO;;;;;;4CAAc;4CAAE;;;;;;;kDAE1B,6WAAC;wCAAK,OAAO;;0DACX,6WAAC;0DAAO;;;;;;4CAAe;4CAAE;;;;;;;kDAE3B,6WAAC;wCAAK,OAAO;;0DACX,6WAAC;0DAAO;;;;;;4CAAiB;4CAAE;;;;;;;;;;;;;0CAI/B,6WAAC;gCAAG,OAAO;;;;;;0CAEX,6WAAC;gCAAQ,OAAO;;kDACd,6WAAC;wCAAQ,OAAO;kDAAI;;;;;;oCACnB,UAAU,MAAM,GAAG,kBAClB,6WAAC;kDACE,UAAU,GAAG,CAAC,CAAC,KAAK,sBACnB,6WAAC;gDAAoB,OAAO;0DAC1B,cAAA,6WAAC;oDAAK,OAAO;;wDACV,QAAQ;wDAAE;sEAAE,6WAAC;4DAAK,MAAM;4DAAK,OAAO;sEAAO;;;;;;;;;;;;+CAFlC;;;;;;;;;iGAQlB,6WAAC;wCAAK,OAAO;kDAAM;;;;;;;;;;;;0CAIvB,6WAAC;gCAAG,OAAO;;;;;;0CAEX,6WAAC;gCAAQ,OAAO;0CACd,cAAA,6WAAC;oCAAO,MAAM;oCAAiB,OAAO;8CAAa;;;;;;;;;;;0CAKrD,6WAAC;gCAAG,OAAO;;;;;;0CAEX,6WAAC;gCAAK,OAAO;0CAAQ;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQjC;AAEA,MAAM,OAAO;IACX,iBAAiB;IACjB,YACE;AACJ;AAEA,MAAM,YAAY;IAChB,iBAAiB;IACjB,QAAQ;IACR,SAAS;IACT,cAAc;AAChB;AAEA,MAAM,MAAM;IACV,SAAS;AACX;AAEA,MAAM,KAAK;IACT,OAAO;IACP,UAAU;IACV,YAAY;IACZ,YAAY;IACZ,QAAQ;AACV;AAEA,MAAM,KAAK;IACT,OAAO;IACP,UAAU;IACV,YAAY;IACZ,YAAY;IACZ,QAAQ;AACV;AAEA,MAAM,OAAO;IACX,OAAO;IACP,UAAU;IACV,YAAY;AACd;AAEA,MAAM,cAAc;IAClB,cAAc;AAChB;AAEA,MAAM,WAAW;IACf,OAAO;IACP,UAAU;IACV,YAAY;IACZ,QAAQ;AACV;AAEA,MAAM,mBAAmB;IACvB,WAAW;AACb;AAEA,MAAM,eAAe;IACnB,cAAc;AAChB;AAEA,MAAM,eAAe;IACnB,OAAO;IACP,UAAU;IACV,YAAY;IACZ,QAAQ;AACV;AAEA,MAAM,OAAO;IACX,OAAO;IACP,gBAAgB;AAClB;AAEA,MAAM,KAAK;IACT,aAAa;IACb,QAAQ;AACV;AAEA,MAAM,gBAAgB;IACpB,WAAW;IACX,WAAW;IACX,cAAc;AAChB;AAEA,MAAM,cAAc;IAClB,iBAAiB;IACjB,cAAc;IACd,OAAO;IACP,UAAU;IACV,YAAY;IACZ,gBAAgB;IAChB,WAAW;IACX,SAAS;IACT,SAAS;AACX;AAEA,MAAM,SAAS;IACb,OAAO;IACP,UAAU;IACV,YAAY;IACZ,WAAW;AACb","debugId":null}},
    {"offset": {"line": 1077, "column": 0}, "map": {"version":3,"sources":["file:///home/phoenix/Documents/gigs/tickeur/src/app/%28auth%29/actions.ts"],"sourcesContent":["\"use server\"\n\nimport { resend } from \"~/lib/resend\";\nimport { cookies } from \"next/headers\";\nimport { from_email } from '../../lib/resend';\nimport { NewUser } from '../../db/schema/user';\nimport { UserService } from \"~/services/user-service\";\nimport { OTPService } from \"~/services/otp-service\";\nimport { LoginFormType, SignupFormType } from \"./schema\";\nimport { VerificationEmail } from \"~/lib/emails/verifications/verification-email\";\nimport { OnboardingResponseEmail } from \"~/lib/emails/onboarding/onboarding-response-email\";\nimport { auth, unstable_update as update_session } from \"~/auth\";\n\nconst otpService = new OTPService()\nconst userService = new UserService();\n\nexport async function signup(props: SignupFormType) {\n    const cookie = await cookies()\n    try {\n        const existingUser = await userService.findByEmail(props.email);\n        if (existingUser) {\n            return {\n                success: false,\n                error: \"User with this email already exists\"\n            };\n        }\n        const user = await userService.createUser(props);\n        const otp = await otpService.createOTP(user.id, \"email_verification\");\n        console.log(\"OTP for verification:\", otp.otp);\n        await resend.emails.send({\n            from: from_email,\n            to: [props.email],\n            subject: \"Email Verification Code\",\n            react: VerificationEmail({ firstName: user.first_name || \"User\", otp: otp.otp }),\n        })\n        cookie.set(\"verify-with\", user.id)\n        return {\n            success: true,\n            user\n        };\n    } catch (error) {\n        return {\n            success: false,\n            error: error instanceof Error ? error.message : \"Failed to create user\"\n        };\n    }\n}\n\n\nexport async function verifyotp(otp: string) {\n    const cookie = await cookies()\n    try {\n        const userId = cookie.get(\"verify-with\")?.value;\n        if (!userId) {\n            return {\n                success: false,\n                error: \"User not found\"\n            };\n        }\n        const user = await userService.findById(userId);\n        if (!user) {\n            return {\n                success: false,\n                error: \"User not found\"\n            };\n        }\n        if (user.is_verified) {\n            return {\n                success: false,\n                error: \"User is already verified\"\n            };\n        }\n        const isValid = await otpService.verifyOTP(userId, otp, \"email_verification\");\n        if (!isValid) {\n            return {\n                success: false,\n                error: \"Invalid OTP\"\n            };\n        }\n        cookie.delete(\"verify-with\");\n        const updatedUser = await userService.updateUser(userId, { is_verified: true, is_active: true, email_verified_at: new Date() });\n        return {\n            success: true,\n            user: updatedUser\n        };\n    } catch (error) {\n        return {\n            success: false,\n            error: error instanceof Error ? error.message : \"Failed to verify OTP\"\n        };\n    }\n}\n\n\nexport async function resendverificationotp() {\n    const cookie = await cookies()\n    try {\n        const userId = cookie.get(\"verify-with\")?.value;\n        if (!userId) {\n            return {\n                success: false,\n                error: \"User not found\"\n            };\n        }\n        const user = await userService.findById(userId);\n        if (!user) {\n            return {\n                success: false,\n                error: \"User not found\"\n            };\n        }\n        const otp = await otpService.createOTP(user.id, \"email_verification\");\n        await resend.emails.send({\n            from: from_email,\n            to: [user.email],\n            subject: \"Email Verification Code\",\n            react: VerificationEmail({ firstName: user.first_name || \"User\", otp: otp.otp }),\n        });\n        cookie.set(\"verify-with\", user.id);\n        return {\n            success: true\n        };\n    } catch (error) {\n        return {\n            success: false,\n            error: error instanceof Error ? error.message : \"Failed to resend OTP\"\n        };\n    }\n}\n\n\nexport const login = async (props: LoginFormType) => {\n    const cookie = await cookies()\n    try {\n        const user = await userService.findByEmail(props.email);\n        if (!user) {\n            return {\n                success: false,\n                error: \"User not found\",\n                type: \"user-not-found\"\n            };\n        }\n\n        if (!user.password) {\n            return {\n                success: false,\n                error: \"User created using social login\",\n                type: \"social-login\"\n            };\n        }\n        const isValid = await userService.comparePassword(props.password, user.password as string);\n        if (!isValid) {\n            return {\n                success: false,\n                error: \"Invalid password\",\n                type: \"invalid-password\"\n            };\n        }\n\n        if (!user.is_verified) {\n            const otp = await otpService.createOTP(user.id, \"email_verification\");\n            await resend.emails.send({\n                from: from_email,\n                to: [user.email],\n                subject: \"Email Verification Code\",\n                react: VerificationEmail({ firstName: user.first_name || \"User\", otp: otp.otp }),\n            });\n            cookie.set(\"verify-with\", user.id);\n            return {\n                success: false,\n                error: \"Account is not verified\",\n                type: \"account-verification\"\n            }\n        }\n        return {\n            success: true,\n            user\n        };\n    } catch (error) {\n        return {\n            success: false,\n            error: error instanceof Error ? error.message : \"Failed to login\",\n            type: \"general\"\n        };\n    }\n};\n\n\nexport async function get_user_by_email(email: string) {\n    try {\n        const user = await userService.findByEmail(email);\n        if (!user) {\n            return {\n                success: false,\n                error: \"User not found\"\n            };\n        }\n        return {\n            success: true,\n            user\n        };\n    } catch (error) {\n        return {\n            success: false,\n            error: error instanceof Error ? error.message : \"Failed to get user\"\n        };\n    }\n}\n\nexport async function google_login(props: { email: string, name: string, providerId: string } & Partial<NewUser>) {\n    try {\n        const user = await userService.findOrCreateSocialUser(props.providerId, {\n            email: props.email,\n            first_name: props.name,\n            user_type: \"normal\",\n        })\n        return {\n            success: true,\n            user\n        }\n    } catch (error) {\n        return {\n            success: false,\n            error: error instanceof Error ? error.message : \"Failed to get user\"\n        };\n    }\n}\n\nexport async function trigger_verification_for_user(userId: string) {\n    const cookie = await cookies()\n    try {\n        const user = await userService.findById(userId);\n        if (!user) {\n            return {\n                success: false,\n                error: \"User not found\"\n            };\n        }\n\n        if (user.is_verified) {\n            return {\n                success: true,\n                message: \"User is already verified\"\n            };\n        }\n\n        const otp = await otpService.createOTP(user.id, \"email_verification\");\n        console.log(\"OTP for verification:\", otp.otp);\n        await resend.emails.send({\n            from: from_email,\n            to: [user.email],\n            subject: \"Email Verification Code\",\n            react: VerificationEmail({ firstName: user.first_name || \"User\", otp: otp.otp }),\n        });\n        cookie.set(\"verify-with\", user.id);\n        return {\n            success: true\n        };\n    } catch (error) {\n        return {\n            success: false,\n            error: error instanceof Error ? error.message : \"Failed to trigger verification\"\n        };\n    }\n}\n\n\n\nexport async function send_onboarding_response({ documents }: { documents: string[] }) {\n    const admin_email = \"giftobafaiye@gmail.com\"\n\n\n    const session = await auth();\n    if (!session?.user?.id) {\n        return {\n            success: false,\n            error: \"Unauthorized - Please log in\"\n        };\n    }\n\n    const user_id = session.user.id;\n    const user = await userService.findById(user_id);\n    if (!user) {\n        return {\n            success: false,\n            error: \"User not found\"\n        };\n    }\n\n    try {\n        await userService.updateUser(user_id, {\n            registration_documents: documents,\n            onboarding_status: 'pending'\n        });\n        const baseUrl = process.env.VERCEL_URL || 'http://localhost:3000';\n        const verificationUrl = `${baseUrl}/verify/${user_id}`;\n\n        await resend.emails.send({\n            from: from_email,\n            to: [admin_email],\n            subject: `New Onboarding Response - ${user.first_name || user.email}`,\n            react: OnboardingResponseEmail({\n                userName: user.first_name || user.email,\n                userEmail: user.email,\n                userId: user.id,\n                documents: documents,\n                verificationUrl: verificationUrl\n            }),\n        });\n\n\n        await update_session({\n            ...session,\n            user: {\n                ...session.user,\n                onboarding_status: 'pending',\n                registration_documents: documents\n            }\n        });\n\n        return {\n            success: true,\n            message: \"Onboarding response sent successfully\"\n        };\n    } catch (error) {\n        return {\n            success: false,\n            error: error instanceof Error ? error.message : \"Failed to send onboarding response\"\n        };\n    }\n\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1433, "column": 0}, "map": {"version":3,"sources":["file:///home/phoenix/Documents/gigs/tickeur/src/auth.config.ts"],"sourcesContent":["import type { User } from './db/schema';\nimport Google from 'next-auth/providers/google'\nimport type { NextAuthConfig } from 'next-auth'\nimport { inDevEnvironment } from './lib/utils'\nimport Credentials from 'next-auth/providers/credentials'\nimport { get_user_by_email, google_login, login, } from './app/(auth)/actions';\n\n\n\nconst authConfig: NextAuthConfig = {\n    providers: [\n        Google({\n            checks: ['none'],\n        }),\n        Credentials({\n            async authorize(credentials) {\n                if (credentials.from_onboarding) {\n                    const data = await get_user_by_email(credentials.email as string)\n                    if (!data.success || !data.user) {\n                        return null\n                    } else {\n                        const user = {\n                            ...data.user,\n                            id: data.user.id,\n                            email: data.user.email\n                        }\n                        return user\n                    }\n                } else {\n                    const data = await login({ email: credentials.email as string, password: credentials.password as string })\n                    if (!data.success || !data.user) {\n                        return null\n                    } else {\n                        const user = {\n                            ...data.user,\n                            id: data.user.id,\n                            email: data.user.email\n                        }\n                        return user\n                    }\n                }\n            }\n        })\n    ],\n    basePath: '/api/auth',\n    session: {\n        strategy: 'jwt',\n    },\n    debug: inDevEnvironment,\n    trustHost: true,\n    callbacks: {\n        async signIn({ account, profile, user }) {\n            if (account?.provider === 'google' && profile?.email) {\n                return true\n            }\n            return !!user\n        },\n        async jwt({ token, user, account, profile, trigger, session }) {\n            if (trigger === 'update') {\n                token = { ...token, ...session.user }\n                return token\n            }\n            if (trigger === 'signIn' && account?.provider === 'credentials' && user) {\n                return { ...token, ...user }\n            }\n            if (account && account.provider === 'google') {\n                if (!profile?.email) {\n                    return null\n                }\n                const res = await google_login({\n                    email: profile.email,\n                    name: profile?.name as string,\n                    providerId: account.providerAccountId,\n                    avatar: profile.picture\n\n                })\n                if (!res.success) {\n                    return null\n                }\n                const google_user = {\n                    ...res.user,\n                    email: profile.email,\n                    name: profile?.name,\n                    profile_image: profile.picture,\n                    id: res?.user?.id,\n                }\n                return { ...token, ...google_user }\n            }\n            return { ...token, user }\n        },\n        async session({ session, token }) {\n            session.user = {\n                ...session,\n                ...token as unknown as User,\n                emailVerified: (token.email_verified_at as Date) ?? new Date()\n            }\n            return session\n        }\n\n    }\n}\n\n\nexport { authConfig }"],"names":[],"mappings":";;;;;;;;;AAGA;;;;;;AAEA;;;;;AAIA,MAAM,aAA6B;IAC/B,WAAW;QACP,OAAO;YACH,QAAQ;gBAAC;aAAO;QACpB;QACA,YAAY;YACR,MAAM,WAAU,WAAW;gBACvB,IAAI,YAAY,eAAe,EAAE;oBAC7B,MAAM,OAAO,MAAM,IAAA,sJAAiB,EAAC,YAAY,KAAK;oBACtD,IAAI,CAAC,KAAK,OAAO,IAAI,CAAC,KAAK,IAAI,EAAE;wBAC7B,OAAO;oBACX,OAAO;wBACH,MAAM,OAAO;4BACT,GAAG,KAAK,IAAI;4BACZ,IAAI,KAAK,IAAI,CAAC,EAAE;4BAChB,OAAO,KAAK,IAAI,CAAC,KAAK;wBAC1B;wBACA,OAAO;oBACX;gBACJ,OAAO;oBACH,MAAM,OAAO,MAAM,IAAA,0IAAK,EAAC;wBAAE,OAAO,YAAY,KAAK;wBAAY,UAAU,YAAY,QAAQ;oBAAW;oBACxG,IAAI,CAAC,KAAK,OAAO,IAAI,CAAC,KAAK,IAAI,EAAE;wBAC7B,OAAO;oBACX,OAAO;wBACH,MAAM,OAAO;4BACT,GAAG,KAAK,IAAI;4BACZ,IAAI,KAAK,IAAI,CAAC,EAAE;4BAChB,OAAO,KAAK,IAAI,CAAC,KAAK;wBAC1B;wBACA,OAAO;oBACX;gBACJ;YACJ;QACJ;KACH;IACD,UAAU;IACV,SAAS;QACL,UAAU;IACd;IACA,OAAO,uIAAgB;IACvB,WAAW;IACX,WAAW;QACP,MAAM,QAAO,EAAE,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE;YACnC,IAAI,SAAS,aAAa,YAAY,SAAS,OAAO;gBAClD,OAAO;YACX;YACA,OAAO,CAAC,CAAC;QACb;QACA,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE;YACzD,IAAI,YAAY,UAAU;gBACtB,QAAQ;oBAAE,GAAG,KAAK;oBAAE,GAAG,QAAQ,IAAI;gBAAC;gBACpC,OAAO;YACX;YACA,IAAI,YAAY,YAAY,SAAS,aAAa,iBAAiB,MAAM;gBACrE,OAAO;oBAAE,GAAG,KAAK;oBAAE,GAAG,IAAI;gBAAC;YAC/B;YACA,IAAI,WAAW,QAAQ,QAAQ,KAAK,UAAU;gBAC1C,IAAI,CAAC,SAAS,OAAO;oBACjB,OAAO;gBACX;gBACA,MAAM,MAAM,MAAM,IAAA,iJAAY,EAAC;oBAC3B,OAAO,QAAQ,KAAK;oBACpB,MAAM,SAAS;oBACf,YAAY,QAAQ,iBAAiB;oBACrC,QAAQ,QAAQ,OAAO;gBAE3B;gBACA,IAAI,CAAC,IAAI,OAAO,EAAE;oBACd,OAAO;gBACX;gBACA,MAAM,cAAc;oBAChB,GAAG,IAAI,IAAI;oBACX,OAAO,QAAQ,KAAK;oBACpB,MAAM,SAAS;oBACf,eAAe,QAAQ,OAAO;oBAC9B,IAAI,KAAK,MAAM;gBACnB;gBACA,OAAO;oBAAE,GAAG,KAAK;oBAAE,GAAG,WAAW;gBAAC;YACtC;YACA,OAAO;gBAAE,GAAG,KAAK;gBAAE;YAAK;QAC5B;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC5B,QAAQ,IAAI,GAAG;gBACX,GAAG,OAAO;gBACV,GAAG,KAAK;gBACR,eAAe,AAAC,MAAM,iBAAiB,IAAa,IAAI;YAC5D;YACA,OAAO;QACX;IAEJ;AACJ","debugId":null}},
    {"offset": {"line": 1565, "column": 0}, "map": {"version":3,"sources":["file:///home/phoenix/Documents/gigs/tickeur/src/auth.ts"],"sourcesContent":["import NextAuth, { DefaultSession } from 'next-auth'\nimport { authConfig } from './auth.config'\nimport { User } from './db/schema'\n\nexport const {\n    handlers: { GET, POST },\n    auth,\n    signOut,\n    unstable_update,\n} = NextAuth({\n    ...authConfig,\n    secret: process.env.AUTH_SECRET,\n})\n\n\ndeclare module 'next-auth' {\n    interface Session {\n        user: User &\n        DefaultSession['user']\n    }\n}"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AACA;;;AAGO,MAAM,EACT,UAAU,EAAE,GAAG,EAAE,IAAI,EAAE,EACvB,IAAI,EACJ,OAAO,EACP,eAAe,EAClB,GAAG,SAAS;IACT,GAAG,mIAAU;IACb,QAAQ,QAAQ,GAAG,CAAC,WAAW;AACnC","debugId":null}},
    {"offset": {"line": 1593, "column": 0}, "map": {"version":3,"sources":["file:///home/phoenix/Documents/gigs/tickeur/src/routes.ts"],"sourcesContent":["export const authRoutes = [\n    '/forgot-password',\n    '/login',\n    '/reset-password',\n    '/signup',\n    '/verify-account',\n    \"/get-started\"\n]\n\nexport const publicRoutes = [\n    '/verify'\n]\n\nexport const apiAuthPrefix = '/api/auth'\n\nexport const DEFAULT_LOGIN_REDIRECT = '/'\n"],"names":[],"mappings":";;;;;;;;;;AAAO,MAAM,aAAa;IACtB;IACA;IACA;IACA;IACA;IACA;CACH;AAEM,MAAM,eAAe;IACxB;CACH;AAEM,MAAM,gBAAgB;AAEtB,MAAM,yBAAyB","debugId":null}},
    {"offset": {"line": 1620, "column": 0}, "map": {"version":3,"sources":["file:///home/phoenix/Documents/gigs/tickeur/src/proxy.ts"],"sourcesContent":["import { auth } from './auth'\nimport { NextResponse } from 'next/server'\nimport type { NextRequest } from 'next/server'\nimport { apiAuthPrefix, authRoutes, publicRoutes } from './routes'\nimport { trigger_verification_for_user } from './app/(auth)/actions'\n\nexport async function proxy(req: NextRequest) {\n    const { nextUrl } = req\n    const session = await auth()\n    console.log(\"Session in proxy:\", session);\n    const isLoggedIn = !!session\n    const isAuthRoute = authRoutes.includes(nextUrl.pathname)\n    const isApiAuthRoute = nextUrl.pathname.startsWith(apiAuthPrefix)\n    const isPublicRoute = publicRoutes.some(route => nextUrl.pathname.startsWith(route))\n\n    if (isApiAuthRoute) {\n        return NextResponse.next()\n    }\n\n    if (isPublicRoute) {\n        return NextResponse.next()\n    }\n\n    if (isAuthRoute) {\n        if (isLoggedIn) {\n            if (session.user.is_verified) {\n                return NextResponse.redirect(new URL('/', req.url))\n            }\n            await trigger_verification_for_user(session.user.id)\n            return NextResponse.redirect(new URL('/verify-account', req.url))\n        }\n        return NextResponse.next()\n    }\n\n    if (!isLoggedIn) {\n        return NextResponse.redirect(\n            new URL(`/login?go_to=${nextUrl.pathname}`, req.url),\n        )\n    }\n\n    return NextResponse.next()\n}\n\nexport const config = {\n    matcher: [\n        '/((?!.+\\\\.[\\\\w]+$|_next).*)',\n        '/',\n        '/(api|trpc)(.*)',\n    ],\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAEA;AACA;;;;;AAEO,eAAe,MAAM,GAAgB;IACxC,MAAM,EAAE,OAAO,EAAE,GAAG;IACpB,MAAM,UAAU,MAAM,IAAA,mHAAI;IAC1B,QAAQ,GAAG,CAAC,qBAAqB;IACjC,MAAM,aAAa,CAAC,CAAC;IACrB,MAAM,cAAc,2HAAU,CAAC,QAAQ,CAAC,QAAQ,QAAQ;IACxD,MAAM,iBAAiB,QAAQ,QAAQ,CAAC,UAAU,CAAC,8HAAa;IAChE,MAAM,gBAAgB,6HAAY,CAAC,IAAI,CAAC,CAAA,QAAS,QAAQ,QAAQ,CAAC,UAAU,CAAC;IAE7E,IAAI,gBAAgB;QAChB,OAAO,6QAAY,CAAC,IAAI;IAC5B;IAEA,IAAI,eAAe;QACf,OAAO,6QAAY,CAAC,IAAI;IAC5B;IAEA,IAAI,aAAa;QACb,IAAI,YAAY;YACZ,IAAI,QAAQ,IAAI,CAAC,WAAW,EAAE;gBAC1B,OAAO,6QAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,IAAI,GAAG;YACrD;YACA,MAAM,IAAA,kKAA6B,EAAC,QAAQ,IAAI,CAAC,EAAE;YACnD,OAAO,6QAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,mBAAmB,IAAI,GAAG;QACnE;QACA,OAAO,6QAAY,CAAC,IAAI;IAC5B;IAEA,IAAI,CAAC,YAAY;QACb,OAAO,6QAAY,CAAC,QAAQ,CACxB,IAAI,IAAI,CAAC,aAAa,EAAE,QAAQ,QAAQ,EAAE,EAAE,IAAI,GAAG;IAE3D;IAEA,OAAO,6QAAY,CAAC,IAAI;AAC5B;AAEO,MAAM,SAAS;IAClB,SAAS;QACL;QACA;QACA;KACH;AACL","debugId":null}}]
}